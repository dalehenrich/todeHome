TDScriptLeafNode{#name:'complexIndex',#contents:'[ :topez :objIn :tokens :windowId | \n| tree population populationIndexSpec query halt create |\n\"explore index sharing for set-valued indexes ... aka mystery of #_findFirstUnsharedPathTerm\"\ncreate := halt := false.\ntokens size > 1\n  ifTrue: [ \n    halt := (tokens at: 2) = \'halt\'.\n    create := (tokens at: 2) = \'create\' ].\ntree := (topez lookup: \'/home/index/family\') dotSelfObject.\npopulation := tree population.\npopulationIndexSpec := GsIndexSpec new\n  equalityIndex: \'each.sons.*.antiqueCollection.contents.*.label\'\n    lastElementClass: String;\n  identityIndex: \'each.sons.*.antiqueCollection\';\n  yourself.\nIndexManager current removeAllIncompleteIndexesOn: population.\n[ \ncreate\n  ifTrue: [ populationIndexSpec createIndexesOn: population ].\nhalt\n  ifTrue: [ \n    population halt.\n    population ]\n  ifFalse: [ \n    | coll |\n    coll := IXAntiqueCollection new askingPrice: 250.\n    query := (GsQuery fromString: \'each.antiqueCollection > coll\')\n      bind: \'coll\' to: coll;\n      on: population;\n      yourself.\n    query queryResult ] ]\n  ensure: [ IndexManager current removeAllIncompleteIndexesOn: population ].\ntrue\n  ifTrue: [ populationIndexSpec removeIndexesFrom: population ] ]',#creationTime:DateAndTime['2013-12-06T17:02:00.58471202850342-08:00'],#modificationTime:@2}